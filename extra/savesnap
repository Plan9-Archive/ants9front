#!/bin/rc

ramsrv=/srv/ramdisk
fscons=/srv/ramfscons
fosfile=/n/ram/fossil
scorefile=/shr/9fat/scorenames

while (~ $1 -*){
	switch($1){
	case -r
		ramsrv=$2
		shift
	case -s
		fscons=$2
		shift
	case -f
		fosfile=$2
		shift
	case -v
		scorefile=$2
		shift
	}
	shift
}

savename=$1
if(~ $#savename 0)
	savename=ramsrv
if(! test -e $fosfile){
	mount $ramsrv /n/ram
	if(! test -e $fosfile){
		echo $fosfile ' not found' >[2=1]
		exit
	}
}

curscore=`{fossil/last $fosfile}
echo 'fsys main snap -a' >> $fscons
sleep 5
newscore=`{fossil/last $fosfile}
while(~ $newscore $curscore){
	sleep 5
	newscore=`{fossil/last $fosfile}
}

if(! ~ $newscore vac*){
	echo 'no score received' >[2=1]
	exit no.score
}

echo $savename '=' $newscore
echo $savename '=' $newscore >>$scorefile
