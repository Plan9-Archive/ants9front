#!/bin/rc

echo 20000 >/tmp/nextport
rfork
while(usercmd=`{read}){
	switch($usercmd){
	case spawn*
		stoport=`{cat /tmp/nextport}
		spawnroot -l $stoport $usercmd(2) &
		echo fetch tcp!^$sysname^!^$stoport
		stoport=`{echo $stoport '+ 1' |hoc}
		echo $stoport >/tmp/nextport
	case fetch*
		echo fetch not supported on storage node
	case save*
		savesnap -r /srv/^$usercmd(2) -s /srv/^$usercmd(2)^fscons $usercmd(3) &
	case clean*
		echo clean
	case exit
		exit
	case *
		echo unknown
	}
}

