#!/bin/rc

echo 20001 >/tmp/nextport
rfork
while(usercmd=`{read}){
	switch($usercmd){
	case spawn*
		stoport=`{cat /tmp/nextport}
		spawnroot -l $stoport $usercmd(2) &
		echo fetch tcp!^$sysname^!^$stoport
		stoport=`{echo $stoport '+ 2' |hoc}
		echo $stoport >/tmp/nextport
	case fetch*
		echo fetch not supported on storage node
	case save*
		savesnap -r /srv/^$usercmd(2) -s /srv/^$usercmd(2)^fscons $usercmd(3) &
	case scores
		if(! test -e /n/9fat/scorenames)
			mount /srv/fatsrv /n/9fat
		cat /n/9fat/scorenames |uniq
	case clean*
		echo clean
	case exit
		exit
	case *
		echo unknown
	}
}

