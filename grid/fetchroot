#!/bin/rc
# dials a storage server to acquire a root and begins services within it

rfork
port=20019
dialstring=tcp!containertest!10564
hubname=inithub

while(~ $1 -*){
	switch($1){
	case -p
		port=$2
		shift
	case -d
		dialstring=$2
		shift
	}
	shift
}

if(! ~ $#1 0)
	hubname=$1

rfork V
srv $dialstring boot
hub -b -z $hubname.$pid
sleep 1
mount /zrv/$hubname.$pid /n/h
echo 'auth/newns' >>/n/h/io0
sleep 1
echo 'startsrvs' >>/n/h/io0
sleep 1
mount -b /srv/factotum /mnt
echo 'aux/listen1 -tv tcp!*!'^$port^' /rc/bin/service/tcp17019 &' >>/n/h/io0
if(! ~ $#1 0){
	chmod 660 /srv/boot
	chgrp -o $1 /srv/boot
}
